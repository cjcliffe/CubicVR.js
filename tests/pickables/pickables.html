<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
	<head>
		<title>Pickables Test</title>
    <style type="text/css">
      body { margin: 0; overflow: hidden; }
    </style>
    <script src="../../CubicVR.js" type="text/javascript"></script>
    <script type='text/javascript'>	
      var canvas;

      window.addEventListener('DOMContentLoaded', function() {
        canvas = document.getElementById('viewport');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        var gl = CubicVR.GLCore.init(canvas, "../../CubicVR_Core.vs", "../../CubicVR_Core.fs");

        if (!gl) {
          alert('Error: No WebGL support.');
          return;
        } //if

        var scene = new CubicVR.Scene(canvas.width, canvas.height, 45);
        scene.setSkyBox(new CubicVR.SkyBox({texture:'../images/space_skybox.jpg'}));

        var textTexture = new CubicVR.TextTexture(['CubicVR.js','Rocks!'],{align:'center', font:'18pt Arial', bgcolor: '#000000' });

        var planeMaterial = new CubicVR.Material({
          color: [0, 0, 1],
          textures: {
            color: textTexture
          }
        });
        var planeMesh = CubicVR.primitives.plane({
          size: 1.0,
          material: planeMaterial,
          uvmapper: {
            projectionMode: CubicVR.enums.uv.projection.PLANAR,
            projectionAxis: CubicVR.enums.uv.axis.Z,
            scale: [1, 1, 1]
          }
        });
        planeMesh.triangulateQuads().compile().clean();

        var sceneObject = new CubicVR.SceneObject(planeMesh);
        scene.bindSceneObject(sceneObject, true);

        material = new CubicVR.Material({color: [0,0,1]});
        mesh = CubicVR.primitives.box({size:.1, material: material});
        mesh.triangulateQuads().compile().clean();
        var so = new CubicVR.SceneObject(mesh);
        so.name = "TEST";
        so.position = [-1,0,0];
        scene.bindSceneObject(so);

        scene.camera.targeted = true;
        scene.camera.position = [0,0,-3];
        scene.camera.target = [0,0,0];
        scene.camera.setClip(1, 10);

        var frames = 0, mouseX = 0, mouseY = 0;
        CubicVR.MainLoop(function(timer, gl) {
          sceneObject.rotation[1] = -2;
          scene.render();
          sceneObject.position[0] = 1;
          if (frames % 2 === 0) {
            var aspect = scene.camera.width/scene.camera.height;
            if (scene.bbRayTest(scene.camera.position, [mouseX, mouseY], 2).length > 0) {
              document.body.style.cursor = 'pointer';
            }
            else {
              document.body.style.cursor = 'default';
            } //if
          } //if
          ++frames;
        });
        window.addEventListener('mousemove', function(e) { mouseX = e.pageX; mouseY = e.pageY; }, false);

      }, false);

    </script>
  </head>
  <body>
    <canvas id="viewport"></canvas>
  </body>
</html>

